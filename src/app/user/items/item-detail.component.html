<div class="container">
    <div class="item-info" *ngIf="item">
        <!-- Item Title -->
        <h1>{{ item.itemTitle }}</h1>

        <!-- Item Seller -->
        <div (click)="goToSellerDetail(seller.username)">
            {{ item.sellerUsername }}
            <span *ngIf="seller && seller.ratingScore">({{ seller.ratingScore }} points)</span>
        </div>

        <!-- Item Description -->
        <p>{{ item.itemDescription }}</p>

        <!-- Images Section -->
        <div class="images-section">
            <h3>Images</h3>
            <div class="image-slider">
                <button (click)="prevImage()">&#10094;</button>
                <img [src]="currentImage" class="item-image" alt="Item Image">
                <button (click)="nextImage()">&#10095;</button>
            </div>
        </div>

        <!-- Documents Section -->
        <div class="documents-section">
            <h3>Documents</h3>
            <ul>
                <li *ngFor="let document of item.documents">
                    <a [href]="document" target="_blank"><i class="fas fa-file-alt"></i> <!-- Document icon -->
                        {{ document | slice: -10 }} <!-- Display a part of the document name --></a>
                </li>
            </ul>
        </div>
    </div>

    <div class="bid-card" *ngIf="item">

        <!-- Current or Starting Bid -->
        <div *ngIf="item.bidStatus === 'A'">
            <h3>{{ item.currentBid > item.minimumBid ? 'Current Bid' : 'Starting Bid' }}</h3>
            <p style="font-size: 28px;font-weight: bold;">{{ item.currentBid | currency }}</p>
            <p>Close in: {{ formatCountdown(item.bidEndDate) }}</p>
            <p>Bid Increment: {{ item.bidIncrement | currency }}</p>

            <div *ngIf="user.username !== item.sellerUsername">
                <!-- Input for new bid -->
                <input type="number" [(ngModel)]="newBidAmount" placeholder="Enter your bid" />
                <button (click)="submitBid()">Submit Bid</button>
            </div>

            <!-- List of Bidders -->
            <h4>Bidders</h4>
            <ul>
                <li *ngFor="let bid of bids">
                    {{ bid.bidderUsername }} - {{ bid.bidAmount | currency }} ({{ bid.bidDate | date:'short' }})
                </li>
            </ul>
        </div>

        <!-- Upcoming Bid -->
        <div *ngIf="item.bidStatus === 'I'">
            <h3>Upcoming Bid</h3>
            <p>Start in: {{ formatCountdown(item.bidStartDate) }}</p>
            <p>Minimum Bid: {{ item.minimumBid | currency }}</p>
            <p>Bid Increment: {{ item.bidIncrement | currency }}</p>
            <p>Bid Start Date: {{ item.bidStartDate | date:'short' }}</p>
            <p>Bid End Date: {{ item.bidEndDate | date:'short' }}</p>
        </div>

        <!-- Bidding Closed -->
        <div *ngIf="item.bidStatus === 'E'">
            <h3>Bidding Closed</h3>
            <p>Final Bid: {{ item.currentBid | currency }}</p>

            <!-- Check if there are any bidders -->
            <div *ngIf="bids && bids.length > 0">
                <p>Winner: {{ winner.bidderUsername }}</p>

                <!-- List of Bidders -->
                <h4>Bidders</h4>
                <ul>
                    <li *ngFor="let bid of bids">
                        {{ bid.bidderUsername }} - {{ bid.bidAmount | currency }} ({{ bid.bidDate | date:'short' }})
                    </li>
                </ul>
            </div>
            <div *ngIf="bids && bids.length === 0">
                <p>No bidders</p>
            </div>
        </div>

        <!-- Hiển thị form đánh giá chỉ cho người chiến thắng -->
        <div *ngIf="item.bidStatus === 'E' && isWinner && !hasRated">
            <h2>Rate {{ item.sellerUsername }}</h2>
            <form [formGroup]="ratingForm" (ngSubmit)="submitRating()">
                <label for="ratingScore">Rating Score:</label>
                <input id="ratingScore" formControlName="ratingScore" type="number" min="1" max="5" />

                <label for="comments">Comments:</label>
                <textarea id="comments" formControlName="comments"></textarea>

                <button type="submit">Submit Rating</button>
            </form>
        </div>

        <!-- Hiển thị thông báo nếu đã đánh giá -->
        <div *ngIf="hasRated">
            <p>You have already rated this item.</p>
        </div>

    </div>
</div>